<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CF466E Information Graph 题解 - 我的个人博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    
    <!-- MathJax 配置脚本，必须在加载 MathJax 主脚本之前 -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    
    <style>
        body { background-size: cover; background-position: center; background-attachment: fixed; font-family: 'Noto Sans SC', sans-serif; transition: background-image 1s ease-in-out; }
        .card { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); border: 1px solid rgba(0,0,0,0.05); }
        html { scroll-behavior: smooth; }
        pre[class*="language-"] { padding: 1rem; margin: 1.5rem 0; border-radius: 0.5rem; }
        /* 为行内代码块添加样式 */
        :not(pre) > code {
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #be123c; /* text-rose-700 */
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.9em;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-5xl font-bold text-gray-900 tracking-wider">Alexxtl的博客</h1>
            <p class="text-gray-600 mt-2">记录、分享、成长</p>
        </header>
        <div class="flex flex-col lg:flex-row gap-8">
            <aside class="w-full lg:w-1/4 flex-shrink-0">
                <div class="space-y-8">
                    <div class="bg-white/70 backdrop-blur-sm rounded-xl p-6 text-center card">
                        <img src="images/avatar.png" alt="博主头像" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-white shadow-lg">
                        <h2 class="text-2xl font-bold">Alexxtl</h2>
                        <p class="text-gray-600 mt-2">一个热爱技术与生活的开发者。</p>
                        <div class="flex justify-center flex-wrap gap-x-4 gap-y-2 mt-4">
                            <a href="https://github.com/Alexxtl" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">GitHub</a>
                            <a href="https://www.luogu.com.cn/user/598187" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">Luogu</a>
                            <a href="https://blog.csdn.net/Alexxtl" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">CSDN</a>
                            <a href="https://codeforces.com/profile/Alex_xtl" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">Codeforces</a>
                            <a href="https://atcoder.jp/users/xiaotianlin" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">AtCoder</a>
                        </div>
                    </div>
                    <div class="bg-white/70 backdrop-blur-sm rounded-xl p-6 card">
                        <h3 class="text-xl font-bold mb-4 border-b pb-2">文章标签</h3>
                        <div class="flex flex-wrap gap-2">
                           
                        </div>
                    </div>
                    <div class="bg-white/70 backdrop-blur-sm rounded-xl p-6 card">
                        <h3 class="text-xl font-bold mb-4 border-b pb-2">友情链接</h3>
                        <ul class="space-y-3 text-gray-700">
                            <li><a href="https://blog.csdn.net/BabyFalse?type=blog" class="hover:text-indigo-600 transition-colors" target="_blank">xwj</a></li>
                            <li><a href="https://www.cnblogs.com/MrSWdAxiv" class="hover:text-indigo-600 transition-colors" target="_blank">fzy</a></li>
                        </ul>
                    </div>
                </div>
            </aside>
            <main class="w-full lg:flex-grow bg-white/70 backdrop-blur-sm rounded-xl p-8 lg:p-12 card">
                <a href="https://alexxtl.github.io/blog/" class="text-indigo-600 hover:underline mb-6 inline-block">&larr; 返回首页</a>
                <h1 class="text-4xl font-bold mb-4 text-gray-900">CF466E Information Graph 题解</h1>
                <div class="text-gray-500 mb-8 border-b pb-4">
                    <span>发布于：2025年09月20日</span> | 
                    <span>作者：Alexxtl</span> | 
                    <span>分类：<a href="#" class="text-purple-600 hover:underline">未分类</a></span>
                </div>
                <article class="prose prose-lg max-w-none text-gray-800">
<p><a href="https://www.cnblogs.com/Alexxtl/p/18312437" class="text-indigo-600 hover:underline" target="_blank"><strong>更好的阅读体验</strong></a></p>
<h2 class="text-2xl font-bold mt-8 mb-4">题目链接</h2>
<p><a href="https://www.luogu.com.cn/problem/CF466E" class="text-indigo-600 hover:underline" target="_blank"><strong>Luogu</strong></a></p>
<p><a href="https://codeforces.com/problemset/problem/466/E" class="text-indigo-600 hover:underline" target="_blank"><strong>Codeforces</strong></a></p>
<h2 class="text-2xl font-bold mt-8 mb-4">题意简述</h2>
<p>某公司中有 $n$ 名员工。为方便起见，将这些员工从 1 至 $n$ 编号。起初，员工之间相互独立。接下来，会有以下 $m$ 次操作：</p>
<p>1. 员工 $y$ 成为员工 $x$ 的上司。<strong>保证此前 $x$ 没有上司</strong>。</p>
<p>2. 员工 $x$ 拿到一份文件并签字，随后交给他的上司。他的上司签字后，再交给更上一级。依此类推，直到文件传递到的那个人没有上司为止。</p>
<p>3. 询问员工 $x$ 是否在第 $i$ 件文件上签过字。文件编号为上一件文件的编号再加 1，第一件文件的编号为 1。如果是，输出 <code></code><code>YES</code><code></code>，否则输出 <code></code><code>NO</code><code></code>。</p>
<h2 class="text-2xl font-bold mt-8 mb-4">解法说明</h2>
<p>显然，我们可以将员工之间的关系看作<strong>森林</strong>，将每个员工看作一个节点，其与上司的关系看作一条边。之所以不是一棵树，是因为在 $m$ 次操作中，有些人可能并没有被指定上司，所以员工之间的关系很可能并不是一棵树而是<strong>森林</strong>。</p>
<p>通过观察题面可以发现，一个员工在成为另一个员工的上司后，就不会再有更改了。由于在线操作过于麻烦，我们可以考虑<strong>离线</strong>。</p>
<p>具体离线方法如下：</p>
<ul class="list-disc pl-5 my-4">
<li>对于操作 1，直接连边即可，不过这里还要<strong>在线</strong>维护一个<strong>并查集</strong>；</li>
</ul>
<ul class="list-disc pl-5 my-4">
<li>对于操作 2，分别记下第一个和最后一个对文件签字的员工，后者就是<strong>前者所在的连通块的根</strong>，利用<strong>并查集</strong>查找；</li>
</ul>
<ul class="list-disc pl-5 my-4">
<li>对于操作 3，分别记下员工编号及文件编号，<strong>离线回答</strong>。</li>
</ul>
<p>接下来分析如何回答询问。可以发现，如果询问的员工 $x$ 在 最开始看到文件 $i$ 的员工与最后看到文件 $i$ 的员工之间的链上，那么 $x$ 就看过文件。所以，问题就被转化为了<strong>判断 $x$ 是否在这条链上</strong>。</p>
<p>考虑如何判断。</p>
<p>设 $st$ 为链的起始点，$ed$ 为截止点，可推得如 $x$ 在链上，则 $\text{lca}(x,st) = x$ 且 $\text{lca}(x,ed) = ed$，维护一个 <strong>LCA</strong> 即可求解。我这里用的是树剖求 LCA，倍增也可以。</p>
<p>还有一些细节需要注意。由于员工之间的关系是<strong>森林</strong>而非一棵树，所以我们在预处理树剖时应枚举每个点，如果该点<strong>是其所属的连通块的根</strong>，就对其进行一次预处理，且回答询问时应首先判断 $x$ 与 $st$、$ed$ <strong>是否在同一连通块内</strong>，如果不在直接输出 <code></code><code>NO</code><code></code>，否则再执行下一步操作。</p>
<p>剩余细节详见下面代码中的注释。</p>
<h2 class="text-2xl font-bold mt-8 mb-4">通过代码</h2>
<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
using namespace std;
#define int long long
#define PII pair&lt;int,int&gt;
#define mp make_pair
const int N=1e5+10;

namespace IO{
    //快读 
    inline int read(){
        int x=0,f=1;
        char ch=getchar();
        while(ch&lt;&apos;0&apos;||ch&gt;&apos;9&apos;){
            if(ch==&apos;-&apos;){
                f=-1;
            }
            ch=getchar();
        }
        while(ch&gt;=&apos;0&apos;&amp;&amp;ch&lt;=&apos;9&apos;){
            x=(x&lt;&lt;1)+(x&lt;&lt;3)+(ch^48);
            ch=getchar();
        }
        return x*f;
    }
    
    //快写 
    inline void write(int x){
        if(x&lt;0){
            putchar(&apos;-&apos;);
            x=-x;
        }
        if(x&gt;9){
            write(x/10);
        }
        putchar(x%10+&apos;0&apos;);
    }
} 

using namespace IO;

namespace code{
    //链式前向星存图 
    int head[N],tot;
    
    struct node{
        int ver,next;
    }t[N&lt;&lt;1];
    
    void add(int x,int y){
        t[++tot].ver=y,t[tot].next=head[x],head[x]=tot;
    }
    
    //并查集
    int fa[N];
    
    int getfa(int x){
        if(fa[x]==x){
            return x;
        }
        return fa[x]=getfa(fa[x]);
    } 
    
    //树链剖分 
    int fat[N],size[N],son[N],deep[N],top[N];
    
    void dfs1(int x){
        size[x]=1;
        int maxson=-1;
        for(int i=head[x];i;i=t[i].next){
            int y=t[i].ver;
            if(y==fat[x]){
                continue;
            } 
            fat[y]=x;
            deep[y]=deep[x]+1;
            dfs1(y);
            if(size[y]&gt;maxson){
                maxson=size[y];
                son[x]=y;
            }
            size[x]+=size[y];
        }
    }
    
    void dfs2(int x,int from){
        top[x]=from;
        if(!son[x]){
            return;
        }
        dfs2(son[x],from);
        for(int i=head[x];i;i=t[i].next){
            int y=t[i].ver;
            if(y==son[x]||y==fat[x]){
                continue;
            }
            dfs2(y,y);
        }
    }
    
    //求LCA
    int lca(int x,int y){
        while(top[x]!=top[y]){
            if(deep[top[x]]&lt;deep[top[y]]){
                swap(x,y);
            }
            x=fat[top[x]];
        }
        if(deep[x]&lt;deep[y]){
            return x;
        }
        return y;
    }
    
    //主程序 
    int n,m,f_tot,q_tot;
    PII file[N],query[N];
    
    void solve(){
        n=read(),m=read();
        for(int i=1;i&lt;=n;i++){//并查集预处理 
            fa[i]=i;
        }
        for(int i=1;i&lt;=m;i++){//离线处理 
            int op=read();
            if(op==1){
                int x=read(),y=read();
                add(y,x);//单向边 
                fa[x]=getfa(y);//在线维护并查集 
            }else if(op==2){
                int x=read();
                file[++f_tot]=mp(x,getfa(x));
            }else{
                int x=read(),y=read();
                query[++q_tot]=mp(x,y);
            }
        }
        for(int i=1;i&lt;=n;i++){//枚举所有点 
            if(getfa(i)==i){//判断是否为所在连通块的根 
                deep[i]=1;//树剖预处理 
                fat[i]=i;
                dfs1(i);
                dfs2(i,i);
            }
        }
        for(int i=1;i&lt;=q_tot;i++){
            int x=query[i].first,y=query[i].second,st=file[y].first,ed=file[y].second;
            if(getfa(x)!=getfa(st)){//是否在同一个连通块 
                printf(&quot;NO\n&quot;);
                continue;
            }
            if(lca(x,st)==x&amp;&amp;lca(x,ed)==ed){//判断 
                printf(&quot;YES\n&quot;);
            }else{
                printf(&quot;NO\n&quot;);
            }
        }
    }
}

using namespace code;

signed main(){
    solve();
    return 0;
}
</code></pre>

                </article>
            </main>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const reliableApi = 'https://api.waifu.pics/sfw/waifu';
            fetch(reliableApi).then(response => response.json()).then(data => {
                const img = new Image();
                img.src = data.url;
                img.onload = () => { document.body.style.backgroundImage = `url('${data.url}')`; };
            }).catch(() => { document.body.style.backgroundColor = '#f3f4f6'; });
        });
    </script>
</body>
</html>