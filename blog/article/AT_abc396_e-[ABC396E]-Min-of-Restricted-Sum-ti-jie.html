<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AT_abc396_e [ABC396E] Min of Restricted Sum 题解 - 我的个人博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    
    <!-- MathJax 配置脚本，必须在加载 MathJax 主脚本之前 -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    
    <style>
        body { background-size: cover; background-position: center; background-attachment: fixed; font-family: 'Noto Sans SC', sans-serif; transition: background-image 1s ease-in-out; }
        .card { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); border: 1px solid rgba(0,0,0,0.05); }
        html { scroll-behavior: smooth; }
        pre[class*="language-"] { padding: 1rem; margin: 1.5rem 0; border-radius: 0.5rem; }
        /* 为行内代码块添加样式 */
        :not(pre) > code {
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #be123c; /* text-rose-700 */
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.9em;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-5xl font-bold text-gray-900 tracking-wider">Alexxtl的博客</h1>
            <p class="text-gray-600 mt-2">记录、分享、成长</p>
        </header>
        <div class="flex flex-col lg:flex-row gap-8">
            <aside class="w-full lg:w-1/4 flex-shrink-0">
                <div class="space-y-8">
                    <div class="bg-white/70 backdrop-blur-sm rounded-xl p-6 text-center card">
                        <img src="images/avatar.png" alt="博主头像" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-white shadow-lg">
                        <h2 class="text-2xl font-bold">Alexxtl</h2>
                        <p class="text-gray-600 mt-2">一个热爱技术与生活的开发者。</p>
                        <div class="flex justify-center flex-wrap gap-x-4 gap-y-2 mt-4">
                            <a href="https://github.com/Alexxtl" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">GitHub</a>
                            <a href="https://www.luogu.com.cn/user/598187" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">Luogu</a>
                            <a href="https://blog.csdn.net/Alexxtl" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">CSDN</a>
                            <a href="https://codeforces.com/profile/Alex_xtl" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">Codeforces</a>
                            <a href="https://atcoder.jp/users/xiaotianlin" target="_blank" class="text-gray-500 hover:text-indigo-600 transition-colors">AtCoder</a>
                        </div>
                    </div>
                    <div class="bg-white/70 backdrop-blur-sm rounded-xl p-6 card">
                        <h3 class="text-xl font-bold mb-4 border-b pb-2">文章标签</h3>
                        <div class="flex flex-wrap gap-2">
                           
                        </div>
                    </div>
                    <div class="bg-white/70 backdrop-blur-sm rounded-xl p-6 card">
                        <h3 class="text-xl font-bold mb-4 border-b pb-2">友情链接</h3>
                        <ul class="space-y-3 text-gray-700">
                            <li><a href="https://blog.csdn.net/BabyFalse?type=blog" class="hover:text-indigo-600 transition-colors" target="_blank">xwj</a></li>
                            <li><a href="https://www.cnblogs.com/MrSWdAxiv" class="hover:text-indigo-600 transition-colors" target="_blank">fzy</a></li>
                        </ul>
                    </div>
                </div>
            </aside>
            <main class="w-full lg:flex-grow bg-white/70 backdrop-blur-sm rounded-xl p-8 lg:p-12 card">
                <a href="https://alexxtl.github.io/blog/" class="text-indigo-600 hover:underline mb-6 inline-block">&larr; 返回首页</a>
                <h1 class="text-4xl font-bold mb-4 text-gray-900">AT_abc396_e [ABC396E] Min of Restricted Sum 题解</h1>
                <div class="text-gray-500 mb-8 border-b pb-4">
                    <span>发布于：2025年09月20日</span> | 
                    <span>作者：Alexxtl</span> | 
                    <span>分类：<a href="#" class="text-purple-600 hover:underline">未分类</a></span>
                </div>
                <article class="prose prose-lg max-w-none text-gray-800">
<h2 class="text-2xl font-bold mt-8 mb-4">题目链接</h2>
<p><a href="https://www.luogu.com.cn/problem/AT_abc396_e" class="text-indigo-600 hover:underline" target="_blank"><strong>Luogu</strong></a></p>
<p><a href="https://atcoder.jp/contests/abc396/tasks/abc396_e" class="text-indigo-600 hover:underline" target="_blank"><strong>Atcoder</strong></a></p>
<h2 class="text-2xl font-bold mt-8 mb-4">题意简述</h2>
<p>#### 问题陈述</p>
<p>给你整数 $N, M$ 和长度为 $M$ 的三个整数序列： $X = (X_1, X_2, \ldots, X_M)$ 、 $Y = (Y_1, Y_2, \ldots, Y_M)$ 和 $Z = (Z_1, Z_2, \ldots, Z_M)$ 。保证 $X$ 和 $Y$ 中的所有元素都在 $1$ 和 $N$ 之间。</p>
<p>我们称长度为 $N$ 的非负整数序列 $A = (A_1, A_2, \ldots, A_N)$ 为<strong>好序列</strong>，当且仅当它满足以下条件时：</p>
<ul class="list-disc pl-5 my-4">
<li>对于 $i$ 与 $1 \le i \le M$ 的每一个整数， $A_{X_i}$ 与 $A_{Y_i}$ 的 XOR 为 $Z_i$ 。</li>
</ul>
<p>确定是否存在一个好序列 $A=(A_1,A_2,\ldots,A_N)$ ，如果存在，找出一个使其元素之和 $\displaystyle \sum_{i=1}^N A_i$ 最小的好序列。</p>
<h2 class="text-2xl font-bold mt-8 mb-4">解法说明</h2>
<p>首先考虑如何判断是否存在好序列。注意到题目中给了许多约束，可以将这些约束关系转化为边，然后在图上进行维护。</p>
<p>容易发现，此时图中被分割成了很多个连通块。对于每个连通块，可以将其中一个节点的权值设为 $0$，并通过约束关系推导出其他节点的权值。这样，在处理新的约束时，如果发现已有的点权与推出的结果相悖，则无解。</p>
<p>这显然可以用带权并查集维护。具体地，每个节点的权值设置为到其父节点的异或值。对于每个约束中的两个点 $x,y$，设其权值为 $a_x$ 和 $a_y$，检查其是否位于同一集合内，分成两种情况进行讨论：</p>
<p>1. $x$ 与 $y$ 在同一集合内时。由于路径压缩，二者会拥有相同的父节点。由于点权维护的是到父节点的异或值，故可将两点权值异或后判断是否与约束中的 $z$ 相等，如果不相等则无解。</p>
<p>2. $x$ 和 $y$ 不在同一个集合内。此时需要合并两个集合。具体地，当合并两个集合时，分别记 $x$ 与 $y$ 所在集合的根节点为 $rx$ 和 $ry$。如合并后令 $rx$ 为根，则由约束关系推得合并后 $a_{rx} = a_x \oplus a_y \oplus z$。</p>
<p>接下来处理和最小的好序列。对于每个连通块的根 $r$，则该连通块的和为块内所有点的权值分别与 $a_r$ 相异或后的和。可以分别处理每个二进制位，统计该连通块中每个 $a_x$ 该位上为 $1$ 的个数，记为 $cnt$。设 $k$ 为该连通块内节点的总个数，则如果 $k-cnt > cnt$ 则根的该位为 $0$，否则为 $1$。</p>
<h2 class="text-2xl font-bold mt-8 mb-4">通过代码</h2>
<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
using namespace std;

#define int long long
const int N=2e5+10;

namespace IO{
	inline int read(){ int x=0,f=1;char ch=getchar(); while(ch&lt;&apos;0&apos;||ch&gt;&apos;9&apos;){ if(ch==&apos;-&apos;) f=-1; ch=getchar(); } while(ch&gt;=&apos;0&apos;&amp;&amp;ch&lt;=&apos;9&apos;) x=(x&lt;&lt;1)+(x&lt;&lt;3)+(ch^48),ch=getchar(); return x*f; }
	inline void write(int x){ if(x&lt;0) putchar(&apos;-&apos;),x=-x; if(x&gt;9) write(x/10); putchar(x%10+&apos;0&apos;); }
}using namespace IO;

namespace code{
	int n,m,a[N],fa[N],cnt[31],ans[N],num;
	vector&lt;int&gt; v[N];
	
	int getfa(int x){
		if(fa[x]==x) return x;
		int r=getfa(fa[x]);
		a[x]^=a[fa[x]],fa[x]=r;
		return r;
	}

	void solve(){
		n=read(),m=read();
		for(int i=1;i&lt;=n;++i) fa[i]=i;
		for(int i=1;i&lt;=m;++i){
			int x=read(),y=read(),z=read();
			int rx=getfa(x),ry=getfa(y);
			if(rx==ry) if((a[x]^a[y])!=z) return write(-1),void();
			if(rx!=ry) fa[ry]=rx,a[ry]=a[x]^a[y]^z;
		}
		for(int i=1,j;i&lt;=n;++i) j=getfa(i),v[j].push_back(i),ans[i]=a[i];
		for(int i=1;i&lt;=n;++i){
			if(fa[i]!=i||v[i].empty()) continue;
			memset(cnt,0,sizeof(cnt)),num=0;
			for(auto it=v[i].begin();it&lt;v[i].end();++it){
				int x=*it;
				for(int j=0;j&lt;=30;++j) cnt[j]+=a[x]&amp;(1&lt;&lt;j)?1:0;
			}
			for(int j=0;j&lt;=30;++j) if(cnt[j]&gt;v[i].size()-cnt[j]) num|=(1&lt;&lt;j);
			for(auto it=v[i].begin();it&lt;v[i].end();++it){
				int x=*it;
				ans[x]^=num;
			}
		}
		for(int i=1;i&lt;=n;++i) write(ans[i]),putchar(&apos; &apos;);
	}
}

signed main(){
	code::solve();
	return 0;
}
</code></pre>

                </article>
            </main>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const reliableApi = 'https://api.waifu.pics/sfw/waifu';
            fetch(reliableApi).then(response => response.json()).then(data => {
                const img = new Image();
                img.src = data.url;
                img.onload = () => { document.body.style.backgroundImage = `url('${data.url}')`; };
            }).catch(() => { document.body.style.backgroundColor = '#f3f4f6'; });
        });
    </script>
</body>
</html>